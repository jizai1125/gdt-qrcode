var GdtQRCode=function(s,i){"use strict";function S(t,f=!0){const e=new URLSearchParams;for(const a in t)if(Object.hasOwn(t,a)){const l=t[a];(!f||l!=null)&&e.append(a,l)}return e.toString()}const L=/^(\d|\.)+$/;function y(t,f="px"){return typeof t=="number"?`${t}${f}`:typeof t=="string"&&L.test(t)?`${t}${f}`:t}const w="https://login-pro.ding.zj.gov.cn",p={domain:w,url:`${w}/oauth2/auth.htm?response_type=code&scope=get_user_info&authType=QRCODE&embedMode=true`,width:"100%",height:320,showLogo:!0,onlyShowCode:!1,blockLine:!0};function C(t,f){if(!t){console.warn("[gdt-qrcode]","dom is not exist");return}const e={config:f,dom:t,domClassName:"gdt-qrcode-wrapper",iframe:void 0,url:void 0,render:l,update:c,updateUrl:m,updateStyle:h,messageHandler:a};e.render(),window.addEventListener("message",a);function a(n){var o,d;n.origin.match(e.config.domain)&&((d=(o=e.config).onScanned)==null||d.call(o,n.data.code,n.data))}function l(){e.dom.innerHTML="",e.dom.classList.add(e.domClassName);const n=document.createElement("iframe");e.iframe=n,e.update(),e.dom.appendChild(n)}function c(n){e.iframe&&(r(n),e.updateUrl(),e.updateStyle())}function m(n){e.iframe&&(n&&r({url:n}),e.url=u(),e.iframe.src=e.url)}function h(n){if(!e.iframe)return;const{width:o,height:d,showLogo:g,onlyShowCode:R,blockLine:b}=r(n);e.iframe.frameBorder="0",e.iframe.width=y(o),e.iframe.height=y(d),e.iframe.style.marginTop=R?"-80px":g?"0":"-40px",e.dom.style.display=b?"block":"inline-block",e.dom.style.overflow="hidden"}function r(n){return e.config={...p,...e.config,...n},e.config}function u(){const{clientId:n,redirectUri:o,url:d}=e.config;return typeof d=="function"?d(e.config):`${d}&${S({client_id:n,redirect_uri:o})}`}return e}const _=i.defineComponent({__name:"QRCode",props:i.mergeDefaults({clientId:{},redirectUri:{},domain:{},url:{type:[String,Function]},width:{},height:{},blockLine:{type:Boolean},showLogo:{type:Boolean},onlyShowCode:{type:Boolean},onScanned:{type:Function}},p),emits:["load","scanned"],setup(t,{emit:f}){const e=t,a=f,l=i.ref(),c=i.ref();function m(){c.value&&a("load",{...c.value})}i.watch([()=>e.url,()=>e.clientId,()=>e.redirectUri],([r,u,n])=>{var o;(o=c.value)==null||o.update({url:r,clientId:u,redirectUri:n}),m()}),i.watch([()=>e.width,()=>e.height,()=>e.onlyShowCode,()=>e.showLogo,()=>e.blockLine],([r,u,n,o,d])=>{var g;(g=c.value)==null||g.updateStyle({width:r,height:u,onlyShowCode:n,showLogo:o,blockLine:d})});function h(r,u){a("scanned",r,u)}return i.onMounted(()=>{c.value=C(l.value,{...e,onScanned:h}),m()}),i.onUnmounted(()=>{c.value&&window.removeEventListener("message",c.value.messageHandler)}),(r,u)=>(i.openBlock(),i.createElementBlock("div",{ref_key:"qrcodeContainerRef",ref:l},null,512))}});return s.QRCode=_,s.defaultConfig=p,s.initQRCode=C,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),s}({},Vue);
