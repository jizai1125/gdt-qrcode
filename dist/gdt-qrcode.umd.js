(function(d,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(d=typeof globalThis<"u"?globalThis:d||self,t(d.GdtQRCode={},d.Vue))})(this,function(d,t){"use strict";const y="https://login-pro.ding.zj.gov.cn",p={domain:y,url:`${y}/oauth2/auth.htm?response_type=code&scope=get_user_info&authType=QRCODE&embedMode=true`,width:220,height:320,showLogo:!0,onlyShowCode:!1};function w(f,l){if(!f){console.warn("[gdt-qrcode]","dom is not exist");return}const e={config:l,dom:f,domClassName:"gdt-qrcode-wrapper",style:void 0,iframe:void 0,url:void 0,render:s,update:c,updateUrl:m,updateStyle:h,messageHandler:a};e.render(),window.addEventListener("message",a);function a(n){var o,i;n.origin.match(e.config.domain)&&((i=(o=e.config).onScanned)==null||i.call(o,n.data.code,n.data))}function s(){e.dom.innerHTML="",e.dom.classList.add(e.domClassName);const n=document.createElement("iframe");e.iframe=n,e.update(),e.dom.appendChild(n)}function c(n){e.iframe&&(r(n),e.updateUrl(),e.updateStyle())}function m(n){e.iframe&&(n&&r({url:n}),e.url=u(),e.iframe.src=e.url)}function h(n){if(!e.iframe)return;const{width:o,height:i,showLogo:_,onlyShowCode:L}=r(n);if(e.iframe.frameBorder="0",e.iframe.width=`${o}px`,e.iframe.height=`${i}px`,e.iframe.style.marginTop=L?"-80px":_?"0":"-40px",!e.style){const g=document.createElement("style");g.innerHTML=`
      .${e.domClassName} {
        display: inline-block;
        overflow: hidden;
      }
      `,e.style=g,e.dom.appendChild(g)}}function r(n){return e.config={...p,...e.config,...n},e.config}function u(){const{clientId:n,redirectUri:o,url:i}=e.config;return typeof i=="function"?i(e.config):`${i}&${C({client_id:n,redirect_uri:o})}`}return e}function C(f,l=!0){const e=new URLSearchParams;for(const a in f)if(Object.hasOwn(f,a)){const s=f[a];(!l||s!=null)&&e.append(a,s)}return e.toString()}const S=t.defineComponent({__name:"QRCode",props:t.mergeDefaults({clientId:{},redirectUri:{},domain:{},url:{type:[String,Function]},width:{},height:{},showLogo:{type:Boolean},onlyShowCode:{type:Boolean},onScanned:{type:Function}},p),emits:["load","scanned"],setup(f,{emit:l}){const e=f,a=l,s=t.ref(),c=t.ref();function m(){c.value&&a("load",{...c.value})}t.watch([()=>e.url,()=>e.clientId,()=>e.redirectUri],([r,u,n])=>{var o;(o=c.value)==null||o.update({url:r,clientId:u,redirectUri:n}),m()}),t.watch([()=>e.width,()=>e.height,()=>e.onlyShowCode,()=>e.showLogo],([r,u,n,o])=>{var i;(i=c.value)==null||i.updateStyle({width:r,height:u,onlyShowCode:n,showLogo:o})});function h(r,u){a("scanned",r,u)}return t.onMounted(()=>{c.value=w(s.value,{...e,onScanned:h}),m()}),t.onUnmounted(()=>{c.value&&window.removeEventListener("message",c.value.messageHandler)}),(r,u)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"qrcodeContainerRef",ref:s},null,512))}});d.QRCode=S,d.defaultConfig=p,d.initQRCode=w,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
