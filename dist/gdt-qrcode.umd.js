(function(a,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(a=typeof globalThis<"u"?globalThis:a||self,o(a.GdtQRCode={},a.Vue))})(this,function(a,o){"use strict";function S(t,u=!0){const e=new URLSearchParams;for(const c in t)if(Object.hasOwn(t,c)){const s=t[c];(!u||s!=null)&&e.append(c,s)}return e.toString()}const L=/^(\d|\.)+$/;function y(t,u="px"){return typeof t=="number"?`${t}${u}`:typeof t=="string"&&L.test(t)?`${t}${u}`:t}const w="https://login-pro.ding.zj.gov.cn",h={domain:w,url:`${w}/oauth2/auth.htm?response_type=code&scope=get_user_info&authType=QRCODE&embedMode=true`,width:"100%",height:320,showLogo:!0,onlyShowCode:!1,blockLine:!0};function C(t,u){if(!t){console.warn("[gdt-qrcode]","dom is not exist");return}const e={config:u,dom:t,domClassName:"gdt-qrcode-wrapper",iframe:void 0,url:void 0,render:s,update:f,updateUrl:m,updateStyle:g,messageHandler:c};e.render(),window.addEventListener("message",c);function c(n){var i,d;n.origin.match(e.config.domain)&&((d=(i=e.config).onScanned)==null||d.call(i,n.data.code,n.data))}function s(){e.dom.innerHTML="",e.dom.classList.add(e.domClassName);const n=document.createElement("iframe");e.iframe=n,e.update(),e.dom.appendChild(n)}function f(n){e.iframe&&(r(n),e.updateUrl(),e.updateStyle())}function m(n){e.iframe&&(n&&r({url:n}),e.url=l(),e.iframe.src=e.url)}function g(n){if(!e.iframe)return;const{width:i,height:d,showLogo:p,onlyShowCode:R,blockLine:b}=r(n);e.iframe.frameBorder="0",e.iframe.width=y(i),e.iframe.height=y(d),e.iframe.style.marginTop=R?"-80px":p?"0":"-40px",e.dom.style.display=b?"block":"inline-block",e.dom.style.overflow="hidden"}function r(n){return e.config={...h,...e.config,...n},e.config}function l(){const{clientId:n,redirectUri:i,url:d}=e.config;return typeof d=="function"?d(e.config):`${d}&${S({client_id:n,redirect_uri:i})}`}return e}const _=o.defineComponent({__name:"QRCode",props:o.mergeDefaults({clientId:{},redirectUri:{},domain:{},url:{type:[String,Function]},width:{},height:{},blockLine:{type:Boolean},showLogo:{type:Boolean},onlyShowCode:{type:Boolean},onScanned:{type:Function}},h),emits:["load","scanned"],setup(t,{emit:u}){const e=t,c=u,s=o.ref(),f=o.ref();function m(){f.value&&c("load",{...f.value})}o.watch([()=>e.url,()=>e.clientId,()=>e.redirectUri],([r,l,n])=>{var i;(i=f.value)==null||i.update({url:r,clientId:l,redirectUri:n}),m()}),o.watch([()=>e.width,()=>e.height,()=>e.onlyShowCode,()=>e.showLogo,()=>e.blockLine],([r,l,n,i,d])=>{var p;(p=f.value)==null||p.updateStyle({width:r,height:l,onlyShowCode:n,showLogo:i,blockLine:d})});function g(r,l){c("scanned",r,l)}return o.onMounted(()=>{f.value=C(s.value,{...e,onScanned:g}),m()}),o.onUnmounted(()=>{f.value&&window.removeEventListener("message",f.value.messageHandler)}),(r,l)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"qrcodeContainerRef",ref:s},null,512))}});a.QRCode=_,a.defaultConfig=h,a.initQRCode=C,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
